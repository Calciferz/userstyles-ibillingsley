/* ==UserStyle==
@name           YouTube Full Theater
@namespace      github.com/ibillingsley
@version        1.1.0
@description    Full screen theatre mode for YouTube
@author         Isaiah Billingsley
@homepageURL    https://github.com/ibillingsley/userstyles
@license        0BSD
==/UserStyle== */

@-moz-document url-prefix("https://www.youtube.com/watch") {

  /* Player occupies full screen height */
  .ytd-page-manager[theater]:not([fullscreen]) #player-wide-container,
  .ytd-page-manager[theater]:not([fullscreen]) #player-theater-container,
  .ytd-page-manager[theater]:not([fullscreen]) #full-bleed-container {
    max-height: 100vh;
    min-height: 100vh;
  }


  /* Top bar hiding with fade-out and visibility */
  #masthead[fullscreen],
  #masthead[theater] {
    --duration--fade-out: 0.7s;
    /* Fade in-out and enable/disable visibility (clickable). */
    transition:
      opacity var(--duration--fade-out) ease-out,
      visibility var(--duration--fade-out);
  }

  /* Theater mode top bar is hidden by default */
  #masthead[theater]:not([fullscreen]) {
    opacity: 0;
  }
  /* Show top bar on hover and when search is focused */
  #masthead[theater]:not([fullscreen]):is(:focus-within, :hover) {
    opacity: 1;
    /* Fade in faster */
    transition-duration: 0.1s, 0.1s;
  }

  /* Fullscreen top bar is hidden when scrolled to top and not focused */
  ytd-app[masthead-hidden] #masthead[fullscreen]:not(:focus-within) {
    /* Fade out */
    opacity: 0;
    /* Make top bar unclickable. Delayed until after fade out is finished. */
    visibility: hidden;
  }
  /* Fullscreen top bar fades out instead of sliding off-screen */
  ytd-app[masthead-hidden] #masthead-container.ytd-app {
    /* Disable sliding off-screen */
    transform: unset;
    opacity: unset;
    transition: unset;
  }

  /* Top bar background */
  #masthead #background {
    /* Smooth out weird transparency jump when scrolled to top */
    transition: opacity 0.7s ease-out;
    /* Blur the top bar's bottom edge */
    box-shadow: 0px -6px 8px 8px var(--yt-spec-base-background);
  }
  /* Add a little transparency to the top bar background when visible */
  #masthead #background:not([style="opacity: 0;"]) {
    opacity: 90% !important;
  }
  /* Add transparency to the searchbox background when not focused */
  #container.ytd-searchbox:not(:focus-within) {
    opacity: 50%;
  }


  /* Replace player top margin with #masthead-container */
  #masthead-container.ytd-app {
    /* Occupy the necessary space for #masthead in basic mode */
    position: sticky;
  }
  /* Collapse #masthead-container in fullscreen and theater mode: there's no space above player */
  #masthead[fullscreen],
  #masthead[theater] {
    position: fixed;
  }
  /* Remove top margin */
  #page-manager.ytd-app {
    margin-top: 0;
  }


  /* Move buttons in top-right corner below the top bar in theater mode */
  .ytd-page-manager[theater]:not([fullscreen]) .ytp-overflow-panel-close,
  .ytd-page-manager[theater]:not([fullscreen]) .ytp-chrome-top {
    padding-top: 50px; /* masthead is 56px, buttons have 6px padding */
    height: unset;
  }
  /* Move endscreen video grid below the title */
  .ytd-page-manager[theater]:not([fullscreen]) .ytp-endscreen-content {
    top: calc(50% + 50px);
  }


  /* Search suggestions popup was off-screen */
  .gstl_50.sbdd_a {
    /* Fix miscalculated position when scrolled down */
    top: 52px !important;
  }


  /** Show video title and buttons in theater mode, hide when playing video - also in fullscreen **/

  /* Video title gradient shadow is only as high as the title instead of darkening the top 1/3 of the video */
  .ytp-chrome-top {
    background-image: linear-gradient(to top, rgb(0 0 0 / 0%), rgb(0 0 0 / 40%) 40px, rgb(0 0 0 / 70%) 100%);
    padding-bottom: 30px;
    left: 0 !important;
    width: 100% !important;
  }
  .ytp-chrome-top > * {
    margin-inline: 12px;
  }
  .ytp-gradient-top {
    display: none;
  }

  /* Video title and buttons fade in-out */
  .ytp-chrome-top {
    /* transition: opacity 0.1s; */
    /* transition: opacity .1s cubic-bezier(.4,0,1,1); */ /* original */
    /* transition-timing-function: ease; */
    /* transition-timing-function: ease-in-out; */
  }
  /* Short transition when hovered */
  .ytp-chrome-top:hover {
    /* transition-duration: 0.1s; */
  }
  /* Delay fade-in for a few seconds after paused, so a short pause won't create distraction. No delay when hovered. */
  .paused-mode .ytp-chrome-top:not(:hover) {
    transition-delay: 1s;
    transition-duration: 0.5s;
  }

  /* Hide video title and buttons when playing and not hovered or focused */
  .ytd-page-manager:is([theater], [fullscreen]) .playing-mode:not(.unstarted-mode) .ytp-chrome-top:not(:hover):not(:focus-within) {
    opacity: 0;
    /* No fade-out delay when hiding */
    transition-delay: 0s;
  }
  /* Show video title and buttons when search is focused */
  #masthead-container:is(:hover, :focus-within) ~ #page-manager .ytp-chrome-top {
    opacity: 1;
  }

  /* Disable hiding of player top buttons and disable fade-out on inactivity */

  /* Disable .ytp-autohide (active when paused or mouse is moving and for 3 seconds after) */
  #movie_player {
    .ytp-title-channel,
    .ytp-title,
    .ytp-button {
      opacity: unset;
      -webkit-transition: unset;
      transition: unset;
    }
  }

  /* Disable .ytp-hide-info-bar (active when not fullscreen) */
  /* and .ytp-autohide (active when paused or mouse is moving and for 3 seconds after). */
  /* Note: .ytp-autohide-active is added (increases precedence) for < 1s while fading out. */
  .ytp-playlist-menu-button,
  .ytp-back-button,
  .ytp-title-channel,
  .ytp-title {
    /* #movie_player for precedence */
    #movie_player & {
      display: unset;
    }
  }
  .ytp-watch-later-button,
  .ytp-copylink-button-visible,
  .ytp-cards-button,
  .ytp-overflow-button-visible {
    /* .ended-mode sets style="display: none;" on most buttons, therefore the !important */
    display: unset !important;
  }

  /* Hide share and search button on fullscreen. Search button seems to be unused. */
  .ytp-search-button,
  .ytp-share-button-visible {
    display: none !important;
  }

  /* Disable hiding of video title in theater mode */
  .ytd-page-manager[theater]:not([fullscreen]) .ytp-hide-info-bar .ytp-chrome-top {
    /* Disable .ytp-hide-info-bar (active when not fullscreen) */
    height: unset;
  }

}
